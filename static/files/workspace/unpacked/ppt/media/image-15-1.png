<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 600">
  <defs>
    <linearGradient id="queryGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="keyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#14b8a6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0d9488;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="valueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7e22ce;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="1400" height="600" fill="#f8fafc"/>

  <!-- Title -->
  <text x="700" y="40" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#1e293b" text-anchor="middle">
    Attention Head Sharing: MHA → GQA → MQA
  </text>
  <text x="700" y="70" font-family="Arial, sans-serif" font-size="16" fill="#64748b" text-anchor="middle">
    Reducing KV Cache Size for Long Context Generation
  </text>

  <!-- MHA Section -->
  <g id="mha-section">
    <rect x="50" y="110" width="380" height="440" rx="10" fill="white" stroke="#cbd5e1" stroke-width="2"/>

    <!-- Header -->
    <rect x="50" y="110" width="380" height="60" rx="10" fill="#64748b"/>
    <text x="240" y="145" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="white" text-anchor="middle">MHA</text>
    <text x="240" y="165" font-family="Arial, sans-serif" font-size="14" fill="#e2e8f0" text-anchor="middle">Multi-Head Attention</text>

    <!-- Query Heads (8) -->
    <text x="70" y="205" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#3b82f6">Q</text>
    <rect x="100" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="140" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="180" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="220" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="260" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="300" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="340" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="380" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>

    <!-- Key Heads (8) -->
    <text x="70" y="270" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#14b8a6">K</text>
    <rect x="100" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="140" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="180" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="220" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="260" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="300" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="340" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="380" y="255" width="35" height="40" rx="3" fill="url(#keyGrad)"/>

    <!-- Value Heads (8) -->
    <text x="70" y="335" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#a855f7">V</text>
    <rect x="100" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="140" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="180" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="220" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="260" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="300" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="340" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="380" y="320" width="35" height="40" rx="3" fill="url(#valueGrad)"/>

    <!-- Stats -->
    <text x="240" y="395" font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">Q heads: 8</text>
    <text x="240" y="415" font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">KV heads: 8</text>

    <!-- Cache Size -->
    <rect x="100" y="440" width="280" height="50" rx="8" fill="#e2e8f0" stroke="#94a3b8" stroke-width="2"/>
    <text x="240" y="460" font-family="Arial, sans-serif" font-size="13" fill="#475569" text-anchor="middle">KV Cache Size</text>
    <text x="240" y="480" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1e293b" text-anchor="middle">1x (Baseline)</text>

    <!-- Used by -->
    <text x="240" y="520" font-family="Arial, sans-serif" font-size="12" fill="#64748b" text-anchor="middle">BERT, GPT-2, GPT-3</text>
  </g>

  <!-- Arrow 1 -->
  <path d="M 450 340 L 490 340" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrow-green)"/>
  <text x="470" y="330" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#10b981" text-anchor="middle">Group</text>

  <!-- GQA Section -->
  <g id="gqa-section">
    <rect x="510" y="110" width="380" height="440" rx="10" fill="white" stroke="#10b981" stroke-width="3"/>

    <!-- Header -->
    <rect x="510" y="110" width="380" height="60" rx="10" fill="#10b981"/>
    <text x="700" y="145" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="white" text-anchor="middle">GQA</text>
    <text x="700" y="165" font-family="Arial, sans-serif" font-size="14" fill="#d1fae5" text-anchor="middle">Grouped-Query Attention</text>

    <!-- Query Heads (8) -->
    <text x="530" y="205" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#3b82f6">Q</text>
    <rect x="560" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="600" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="640" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="680" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="720" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="760" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="800" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="840" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>

    <!-- Key Heads (2 - shared across groups) -->
    <text x="530" y="270" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#14b8a6">K</text>
    <rect x="560" y="255" width="155" height="40" rx="3" fill="url(#keyGrad)"/>
    <rect x="720" y="255" width="155" height="40" rx="3" fill="url(#keyGrad)"/>

    <!-- Value Heads (2 - shared across groups) -->
    <text x="530" y="335" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#a855f7">V</text>
    <rect x="560" y="320" width="155" height="40" rx="3" fill="url(#valueGrad)"/>
    <rect x="720" y="320" width="155" height="40" rx="3" fill="url(#valueGrad)"/>

    <!-- Grouping indicators -->
    <path d="M 560 235 L 695 235" stroke="#3b82f6" stroke-width="2" stroke-dasharray="4,2" fill="none"/>
    <text x="627" y="250" font-family="Arial, sans-serif" font-size="11" fill="#3b82f6" text-anchor="middle">Group 1</text>

    <path d="M 720 235 L 855 235" stroke="#3b82f6" stroke-width="2" stroke-dasharray="4,2" fill="none"/>
    <text x="787" y="250" font-family="Arial, sans-serif" font-size="11" fill="#3b82f6" text-anchor="middle">Group 2</text>

    <!-- Stats -->
    <text x="700" y="395" font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">Q heads: 8</text>
    <text x="700" y="415" font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">KV heads: 2</text>

    <!-- Cache Size -->
    <rect x="560" y="440" width="280" height="50" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <text x="700" y="460" font-family="Arial, sans-serif" font-size="13" fill="#065f46" text-anchor="middle">KV Cache Size</text>
    <text x="700" y="480" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#065f46" text-anchor="middle">¼x (4x smaller)</text>

    <!-- Used by -->
    <text x="700" y="520" font-family="Arial, sans-serif" font-size="12" fill="#064e3b" text-anchor="middle">LLaMA-2 70B, Mistral</text>
  </g>

  <!-- Arrow 2 -->
  <path d="M 910 340 L 950 340" stroke="#f59e0b" stroke-width="4" fill="none" marker-end="url(#arrow-orange)"/>
  <text x="930" y="330" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f59e0b" text-anchor="middle">Share</text>

  <!-- MQA Section -->
  <g id="mqa-section">
    <rect x="970" y="110" width="380" height="440" rx="10" fill="white" stroke="#f59e0b" stroke-width="3"/>

    <!-- Header -->
    <rect x="970" y="110" width="380" height="60" rx="10" fill="#f59e0b"/>
    <text x="1160" y="145" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="white" text-anchor="middle">MQA</text>
    <text x="1160" y="165" font-family="Arial, sans-serif" font-size="14" fill="#fef3c7" text-anchor="middle">Multi-Query Attention</text>

    <!-- Query Heads (8) -->
    <text x="990" y="205" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#3b82f6">Q</text>
    <rect x="1020" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="1060" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="1100" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="1140" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="1180" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="1220" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="1260" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>
    <rect x="1300" y="190" width="35" height="40" rx="3" fill="url(#queryGrad)"/>

    <!-- Single Key Head -->
    <text x="990" y="270" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#14b8a6">K</text>
    <rect x="1020" y="255" width="315" height="40" rx="3" fill="url(#keyGrad)"/>

    <!-- Single Value Head -->
    <text x="990" y="335" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#a855f7">V</text>
    <rect x="1020" y="320" width="315" height="40" rx="3" fill="url(#valueGrad)"/>

    <!-- Sharing indicator -->
    <path d="M 1020 235 L 1315 235" stroke="#3b82f6" stroke-width="2" stroke-dasharray="4,2" fill="none"/>
    <text x="1167" y="250" font-family="Arial, sans-serif" font-size="11" fill="#3b82f6" text-anchor="middle">All queries share same K,V</text>

    <!-- Stats -->
    <text x="1160" y="395" font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">Q heads: 8</text>
    <text x="1160" y="415" font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">KV heads: 1</text>

    <!-- Cache Size -->
    <rect x="1020" y="440" width="280" height="50" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="1160" y="460" font-family="Arial, sans-serif" font-size="13" fill="#78350f" text-anchor="middle">KV Cache Size</text>
    <text x="1160" y="480" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#78350f" text-anchor="middle">⅛x (8x smaller)</text>

    <!-- Used by -->
    <text x="1160" y="520" font-family="Arial, sans-serif" font-size="12" fill="#78350f" text-anchor="middle">Falcon-40B, PaLM</text>
  </g>

  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="560" width="150" height="25" rx="3" fill="url(#queryGrad)"/>
    <text x="125" y="577" font-family="Arial, sans-serif" font-size="13" fill="white" text-anchor="middle" font-weight="bold">Query</text>

    <rect x="220" y="560" width="150" height="25" rx="3" fill="url(#keyGrad)"/>
    <text x="295" y="577" font-family="Arial, sans-serif" font-size="13" fill="white" text-anchor="middle" font-weight="bold">Key</text>

    <rect x="390" y="560" width="150" height="25" rx="3" fill="url(#valueGrad)"/>
    <text x="465" y="577" font-family="Arial, sans-serif" font-size="13" fill="white" text-anchor="middle" font-weight="bold">Value</text>
  </g>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
    <marker id="arrow-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f59e0b" />
    </marker>
  </defs>
</svg>
